<!DOCTYPE html>
<html>
  <head>
      <meta charset="UTF-8" />
      <title>Smart Devices</title>

      <!-- Remember to edit the CSS so that your result looks similar
      to expectedresult.png -->
      <link rel="stylesheet" href="_css/main.css">

      <script src="_js/jquery-1.11.0.min.js"></script>
      <script src="_js/highcharts.js"></script>
  </head>

  <body>

    <div id="wrapper">
      <h1>Smart Devices</h1>
      <p>Gabe Nicholas and Natalia Timakova</p>
      <div id = "chart-one-container"></div>
      <div id = "chart-two-container"></div>
      <div id = "chart-three-container"></div>


      <script type="text/javascript">
        $.get("_data/smartdevices.csv", function (data) {

          // Let's load the data!
          gNumSold = [];          // Chart #1
          gPercentReturned = [];  // Chart #2
          gDaysToShip = [];       // Chart #3

          var lines = data.split('\n').slice(1);
          var deviceCount = 9

          var totalCount = 0
          var totalReturned = 0

          $.each(lines, function(lineNo, line) {
                kProductType = 0;
                kNumSold = 1;
                kYear = 2;
                kAvgDaysToShip = 3;
                kReturnedOnAverage = 4;

                var items = line.split(",");

            if (lineNo < deviceCount) {
              gDaysToShip.push([items[kProductType], Number(items[kAvgDaysToShip])]);
            }
            gNumSold.push([items[kProductType], items[kYear], Number(items[kNumSold])]);
            window.gPercentReturned.push([items[kProductType], items[kYear], Number(items[kReturnedOnAverage])])


            totalCount += parseFloat(items[kNumSold])
            totalReturned += parseFloat(items[kNumSold]) * parseFloat(items[kReturnedOnAverage])
            if ((lineNo + 1) % deviceCount == 0) {
              window.gPercentReturned.push(["Average", items[kYear], Math.round(totalReturned/totalCount)]);
              totalCount = 0;
              totalReturned = 0;
            }
          });

          console.log(gPercentReturned)

        });
      </script>
    </div>
  </body>
</html>
